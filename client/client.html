<!doctype html>
<html lang="en">
  <head>
    <title>VirtualStocks API</title>
    <!-- Required meta tags -->
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

    <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/font-awesome/4.7.0/css/font-awesome.min.css">

    <!-- Bootstrap CSS -->
    <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.3.1/css/bootstrap.min.css" integrity="sha384-ggOyR0iXCbMQv3Xipma34MD+dH/1fQ784/j6cY/iJTQUOhcWr7x9JvoRxT2MZw1T" crossorigin="anonymous">
  </head>
  <body>
      <div class="container">
        <div id="title" class="title text-center top-margin"></div>
        <div id="mainWindow"></div>
        <nav class="navbar navbar-expand-sm navbar-light bg-primary fixed-bottom row">
          <button class="btn btn-primary left-margin" id="chart" onclick="getchart()">차트</button>
          <button class="btn btn-primary" id="buy" onclick="getBuy()">매수</button>
          <button class="btn btn-primary" id="sell">매도</button>
          <button class="btn btn-primary" id="bank">은행</button>
          <button class="btn btn-primary right-margin" id="casino">도박</button>
        </nav>
      </div>


      <style>
        @import url(http://fonts.googleapis.com/earlyaccess/notosanskr.css);

        .title {
          font-family: 'Noto Sans KR', sans-serif;
        }

        .left-margin {
          margin-left: 5px;
        }

        .right-margin {
          margin-right: 5px;
        }

        .top-margin {
          margin-top: 5px;
        }
      </style>
    <!-- Optional JavaScript -->
    <!-- jQuery first, then Popper.js, then Bootstrap JS -->
    <script src="https://code.jquery.com/jquery-3.3.1.slim.min.js" integrity="sha384-q8i/X+965DzO0rT7abK41JStQIAqVgRVzpbzo5smXKp4YfRvH+8abtTE1Pi6jizo" crossorigin="anonymous"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.14.7/umd/popper.min.js" integrity="sha384-UO2eT0CpHqdSJQ6hJty5KVphtPhzWj9WO1clHTMGa3JDZwrnQq4sF86dIHNDz0W1" crossorigin="anonymous"></script>
    <script src="https://stackpath.bootstrapcdn.com/bootstrap/4.3.1/js/bootstrap.min.js" integrity="sha384-JjSmVgyd0p3pXB1rRibZUAYoIIy6OrQ6VrjIEaFf/nJGzIxFDsf4x0xIM+B07jRM" crossorigin="anonymous"></script>
      
      <script>
        let temp
        getchart()
        function getchart () {
          document.getElementById("chart").classList.replace("btn-primary", "btn-dark")
          document.getElementById("buy").classList.replace("btn-dark", "btn-primary")
          document.getElementById("sell").classList.replace("btn-dark", "btn-primary")
          document.getElementById("bank").classList.replace("btn-dark", "btn-primary")
          document.getElementById("casino").classList.replace("btn-dark", "btn-primary")
          temp = "<table class=\"table top-margin\"><thead><th scope=\"col\">종목명</th><th scope=\"col\">전날 대비</th><th scope=\"col\">현재가격</th><th scope=\"col\">남은 주</th></tr></thead><tbody>"
          // get JSON with using pure javascript
          var xhr= new XMLHttpRequest()
          var target= "https://api.jsonbin.io/b/5c9cd7b9da12e364adfb7737/latest"
          xhr.open("GET", target)
          xhr.send()

          xhr.onreadystatechange = function() {
            if (xhr.readyState=== XMLHttpRequest.DONE){
              if (xhr.status== 200){
                let info = JSON.parse(xhr.responseText).info
                let chart = JSON.parse(xhr.responseText).chart
                for (let counter = 0; counter < chart.length; counter++) {
                  temp += "<tr><td scope=\"row\">" + chart[counter].name + "</td>"
                  if (chart[counter].after < chart[counter].before) {
                    temp += "<td style=\"color: red;\"> ▼ " + (chart[counter].before - chart[counter].after) + "</td>"
                  }
                  if (chart[counter].after > chart[counter].before) {
                    temp += "<td style=\"color: green;\"> ▲ " + (chart[counter].after - chart[counter].before) + "</td>"
                  }
                  if (chart[counter].after === chart[counter].before) {
                    temp += "<td> - " + 0 + "</td>"
                  }
                  temp += "<td>" + chart[counter].after + "</td>"
                  temp += "<td>" + chart[counter].count + "주</td></tr>"
                }
                let last = new Date(info.lastUpdate)
                let next = new Date(info.nextUpdate)
                let now = new Date()
              temp += "</tbody></table><hr />이전 가격 변동: " + last.getHours() + " : " + last.getMinutes() + "<br/>다음 가격 변동: " + next.getHours() + " : " + next.getMinutes() + " (" + Math.round((next.getTime() - now.getTime()) / 1000) + "초후) <button class=\"btn btn-warning\" onclick=\"getchart()\"></button>"
                document.getElementById('mainWindow').innerHTML = temp
                document.getElementById("title").innerHTML = "<h2>" + (now.getMonth() + 1) + "/" + now.getDate() + " 주식시장</h2>"
              } else {
                alert("fail to load");
              }
            }
          }
        }

        function getBuy () {
          document.getElementById("chart").classList.replace("btn-dark", "btn-primary")
          document.getElementById("buy").classList.replace("btn-primary", "btn-dark")
          document.getElementById("sell").classList.replace("btn-dark", "btn-primary")
          document.getElementById("bank").classList.replace("btn-dark", "btn-primary")
          document.getElementById("casino").classList.replace("btn-dark", "btn-primary")
          temp = "개발중"
          document.getElementById('mainWindow').innerHTML = temp
        }
      </script>
  </body>
</html>